var len,indexCon,res,timer,render=player.render,audios=player.audioManager,time=player.time;function getData(e){$.ajax({type:"GET",url:e,success:function(e){render(e[0]),len=(res=e).length,indexCon=new player.indexControl(len),audios.getAudio(e[0]),time.renderTime(e[0].duration),bindEvent(),touchEvent()}})}function bindEvent(){$("body").on("playChange",function(e,t){$(".img").css({transform:"rotateZ(0deg)"}),audios.getAudio(res[t]),render(res[t]),time.renderTime(res[t].duration),time.pro=0,time.proTime=0,"play"==audios.status&&(audios.play(),rotate(0),time.start())}),$(".play").on("click",function(){"pause"==audios.status?(time.start(),audios.play(),rotate($(".img").data("deg")),$(this).addClass("pause")):(audios.pause(),clearInterval(timer),time.stop(),$(this).removeClass("pause"))}),$(".prve").on("click",function(){$(".img").data("deg",0);var e=indexCon.prve();$("body").trigger("playChange",e)}),$(".next").on("click",function(){$(".img").data("deg",0);var e=indexCon.next();$("body").trigger("playChange",e)})}function touchEvent(){var n=$(".bar-bg").offset().left,o=$(".bar-bg").width();$(".circle").on("touchstart",function(e){audios.pause()}).on("touchmove",function(e){var t=e.changedTouches[0].clientX,a=t-n,i=(a=o<a?o:a)/o;$(".bar-show").offset({left:t-a}),time.pro=i,time.proTime=i*time.duration,0<i&&i<1&&time.update(i)}).on("touchend",function(){0<time.pro&&time.pro<1&&(audios.playTo(time.proTime),$(".play").trigger("click"))})}function rotate(e){clearInterval(timer),e=+e,timer=setInterval(function(){e+=2,$(".img").data("deg",e).css({transform:"rotateZ("+e+"deg)"})},300)}getData("../mock/data.json"),$(audios.audio).on("ended",function(){$(".next").trigger("click")});